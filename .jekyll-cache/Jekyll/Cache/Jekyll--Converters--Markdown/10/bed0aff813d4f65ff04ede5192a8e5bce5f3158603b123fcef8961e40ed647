I"Ü)<h1 id="í›„ê¸°">í›„ê¸°</h1>

<p><img src="/assets/images/posts/coursera_JenkinsPipeline-DeclarativeandIaCapproachesforDevOps_course_info.png" alt="ê°•ì¢Œì— ëŒ€í•œ ì„¤ëª…" /></p>

<ul>
  <li>í•´ë‹¹ ê°•ì¢ŒëŠ” ì˜ìƒí”Œë ˆì´ ì‹œê°„ 2ì‹œê°„ (í•˜ì§€ë§Œ ì˜ì–´ ê°•ì¢Œì—¬ì„œ 3ì‹œê°„ ì´ìƒ) ì†Œìš” ë˜ëŠ” ê°•ì¢Œì…ë‹ˆë‹¤.</li>
  <li>ì¥ì ì€ ë¶€ë‹´ë˜ëŠ” ì–‘ì˜ ìë£Œ (ì±…, ê°•ì˜ ë“±) ë¥¼ ë³´ê¸° ì „ì— ì§§ì€ ì‹œê°„ í›‘ì–´ë³´ê¸°ì— ì¢‹ì€ ê°•ì˜ë¼ëŠ” ì ì…ë‹ˆë‹¤.</li>
  <li>ëŒ€ë¶€ë¶„ Declarative Script ë¡œ Jenkinsfile ì„ ì‘ì„±í•˜ì—¬ í™œìš©í•  ê²ƒìœ¼ë¡œ ìƒê°í•˜ëŠ” ë°”, ê¸°ì´ˆì— ì¢‹ì€ ê°•ì˜ì¼ë“¯ ì‹¶ìŠµë‹ˆë‹¤.</li>
</ul>

<h1 id="ê°•ì¢Œ">ê°•ì¢Œ</h1>

<h2 id="íŒŒì´í”„ë¼ì¸ì´ë€-ë¬´ì—‡ì¸ê°€">íŒŒì´í”„ë¼ì¸ì´ë€ ë¬´ì—‡ì¸ê°€?</h2>

<ul>
  <li>ì •ì˜ì™€ ê¸°ëŠ¥
    <ul>
      <li>SCM(Source Code Management) ì˜ Continuous Delivery ì ˆì°¨ë¥¼ ìœ„í•œ í”ŒëŸ¬ê·¸ì¸ ì§‘í•©</li>
      <li>ì œí’ˆ ê°œë°œ ë¼ì´í”„ì‚¬ì´í´ (Submitting Code -&gt; Testing -&gt; Staging -&gt; Deployment â€¦) ì— ì—°ê´€</li>
      <li>ê° ë‹¨ê³„ì˜ ì„±ê³µ / ì‹¤íŒ¨ ì—¬ë¶€ ì œê³µ</li>
      <li>ë‹¤ì–‘í•œ íƒ€ í™˜ê²½ì—ì„œì˜ ìš´ì˜ ì§€ì›</li>
      <li>ì €ì¥ì†Œ ë‹¨ê³„ì—ì„œ ì‹¤ í™˜ê²½ ë°°í¬ê¹Œì§€ì˜ ìë™í™”</li>
    </ul>
  </li>
  <li>íŒŒì´í”„ë¼ì¸ ì‘ì„±ë²•
    <ul>
      <li>Pipeline script ë¥¼ Jenkins UI ì—ì„œ ì‘ì„±</li>
      <li>Jenkins file ì„ í†µí•œ ì‘ì„±</li>
    </ul>
  </li>
  <li>íŒŒì´í”„ë¼ì¸ ì–¸ì–´
    <ul>
      <li><strong>declarative</strong></li>
      <li>scripted</li>
    </ul>
  </li>
  <li>jenkinsfile ì˜ ì¥ì 
    <ul>
      <li>IaC (Infrastructure as Code)
        <ul>
          <li>application code ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì·¨ê¸‰ë˜ì–´ ì €ì¥ì†Œì— committed ë¨</li>
          <li>ì €ì¥ì†Œì˜ ì´ì ì„ ëˆ„ë¦¬ë©°, ë™ì‹œì— ì–´ë–¤ êµ¬ì¡°ë¡œ ë˜ì–´ìˆëŠ”ì§€ êµ¬ì„±ì›ë“¤ì´ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŒ</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="íŒŒì´í”„ë¼ì¸-ìŠ¤í¬ë¦½íŠ¸ì˜-í˜•íƒœì™€-ì „ì—­ë³€ìˆ˜">íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ì˜ í˜•íƒœì™€ ì „ì—­ë³€ìˆ˜</h2>

<ul>
  <li>ì  í‚¨ìŠ¤ ì„œë²„ êµ¬ë™
  <code class="language-plaintext highlighter-rouge">java -jar jenkins.war httpPort=8080</code>
    <ul>
      <li>ë¸Œë¼ìš°ì €ì—ì„œ <code class="language-plaintext highlighter-rouge">localhost:8080</code> ìœ¼ë¡œ ì ‘ì†</li>
      <li>ê¸°ë³¸ ê³„ì • ë¡œê·¸ì¸ : admin / admin</li>
    </ul>
  </li>
  <li>new items
    <ul>
      <li>ë„¤ì´ë°</li>
      <li>Pipeline ìƒì„±</li>
      <li>
        <p>Pipeline ì„¹ì…˜ìœ¼ë¡œ ì´ë™</p>
      </li>
      <li>Jenkinsfile (Declarative Pipeline)
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  pipeline {
      agent any // Execute this Pipeline or any of its stages, on any available agent.
      stages {
          // stage : conceptually distinct subset or tasks performed throughout the entire pipeline
          stage('Build') { // Defines the "Build" stage. (Keyword is flexible)
              // Steps represents a single task.
              // It tells Jenkins what to do at a particular point in time of a particular step in the process.
              steps {
                  //  Perform some steps related to the "Build" stage.
              }
          }
          stage('Test') { // Defines the "Test" stage.
              steps {
                  // Perform some steps related to the '"Test" stage.
              }
          }
          stage('Deploy') { Defines the "Deploy" stage. 
              steps {
                  // Perform some steps related to the "Deploy" stage.
              }
          }
      }
  }
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Environment Variables (Global Variables)
    <ul>
      <li><strong><code class="language-plaintext highlighter-rouge">http://localhost:8080/pipeline-syntax/globals#env</code></strong></li>
    </ul>
  </li>
</ul>

<h2 id="ì²«-íŒŒì´í”„ë¼ì¸-ìŠ¤í¬ë¦½íŠ¸-ì‘ì„±ê³¼-í™˜ê²½ë³€ìˆ˜-ì‚½ì…">ì²« íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ê³¼ í™˜ê²½ë³€ìˆ˜ ì‚½ì…</h2>

<ul>
  <li>
    <p>pipeline ì„¹ì…˜ì— ì½”ë“œ ì‘ì„±</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      pipeline {
          agent any
          stages {
              stage('stage 1'){
                  steps {
                      echo "hello world"
                      echo BUILD_ID // Global Variable
                  }
              }
          }
      }
</code></pre></div>    </div>

    <ul>
      <li>Build Now</li>
      <li>Console Output í™•ì¸</li>
    </ul>
  </li>
  <li>
    <p>environment ë³€ìˆ˜ ì‚½ì…</p>
    <ul>
      <li>environment ë³€ìˆ˜ëŠ” ìµœìƒë‹¨ì— ìœ„ì¹˜í•  ìˆ˜ë„, stage ì•ˆì— ì¡´ì¬í•  ìˆ˜ë„ ìˆìŒ</li>
    </ul>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      pipeline {
          agent any
          environment {
              mainenv = 'dev'
          }
          stages {
              stage('stage 1'){
                  steps {
                      echo "hello world"
                      echo BUILD_ID
                      echo """mainenv = ${mainenv}""" // enject template, literals, variables
                  }
              }
          }
      }
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      pipeline {
          agent any
          environment {
              mainenv = 'dev'
          }
          stages {
              stage('stage 1'){
                  environment{
                      subenv = "prod"
                  }
                  steps {
                      echo """inside stage 1: mainenv = ${mainenv}""" // enject template, literals, variables
                      echo """inside stage 1: subenv = ${subenv}"""
                  }
              }
              stage('stage 2'){
                  steps {
                      echo """inside stage 2: mainenv = ${mainenv}"""
                      echo """inside stage 2: subenv = ${subenv}""" // causing error, because of scope.
                  }
              }
          }
      }
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="ì‹¤ì œ-github-ì €ì¥ì†Œë¥¼-ì‚¬ìš©í•œ-íŒŒì´í”„ë¼ì¸-ìŠ¤í¬ë¦½íŠ¸-ì‘ì„±ê³¼-build-steps">ì‹¤ì œ Github ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•œ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ê³¼ build steps</h2>

<ul>
  <li>ëŒ€ì‹œë³´ë“œì—ì„œ new item ì„ íƒ
    <ul>
      <li>Pipeline ìƒì„±
        <ul>
          <li>ìš°ì¸¡ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ìƒ˜í”Œ ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŒ</li>
          <li>Pipeline Syntax ì—ì„œ Snippet Generator í™œìš©í•˜ê¸°</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>Most common MVN build phases</p>

    <table>
      <thead>
        <tr>
          <th style="text-align: left">Build Phase</th>
          <th style="text-align: left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: left">validate</td>
          <td style="text-align: left">Validates that the project is correct and all necessary information is available. This also makes sure the dependencies are downloaded.</td>
        </tr>
        <tr>
          <td style="text-align: left">compile</td>
          <td style="text-align: left">Compiles the source code of the project.</td>
        </tr>
        <tr>
          <td style="text-align: left">test</td>
          <td style="text-align: left">Runs the tests against the compiled source code using a suitable unit testing framework. These tests should not require the code be packaged or deployed.</td>
        </tr>
        <tr>
          <td style="text-align: left">package</td>
          <td style="text-align: left">Packs the compiled code in its distributable format. such as a JAR.</td>
        </tr>
        <tr>
          <td style="text-align: left">install</td>
          <td style="text-align: left">Install the package into the local repository, for use as a dependency in other projects locally.</td>
        </tr>
        <tr>
          <td style="text-align: left">deploy</td>
          <td style="text-align: left">Copies the final package to the remote repository for sharing with other developers and projects.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>ì‘ì„±í•œ ì†ŒìŠ¤ì½”ë“œ</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      pipeline {
      	agent any
      	stages {
          	stage('Setup'){
              	steps {
                   	// this will delete folder whatever the OS platform is.
                  	dir('jenkins-spring'){
                      	deleteDir()               
                  	}
              	}
          	}
          	stage('Build'){
              	steps {
                  	// sh : for Linux
                  	// for Windows (copy github source)
                  	bat 'git clone https://github.com/rudihinds/jenkins-spring.git'
                  	bat 'mvn clean -f jenkins-spring'
              	}
          	}
          	stage('Test'){
              	steps {
                  	bat 'mvn clean test -f jenkins-spring'
              	}
          	}
          	stage('Deploy'){
              	steps {
                  	bat 'mvn clean package -f jenkins-spring'
              	}
          	}
      	}
      }
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="jenkinsfile-ì„-ì´ìš©í•˜ì—¬-scm-ì—-íŒŒì´í”„ë¼ì¸-ì—°ê²°">Jenkinsfile ì„ ì´ìš©í•˜ì—¬ SCM ì— íŒŒì´í”„ë¼ì¸ ì—°ê²°</h2>

<ul>
  <li>SCM ì„ í†µí•´ ì–´ë–»ê²Œ íŒŒì´í”„ë¼ì¸ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ”ì§€?</li>
  <li>ë³µì¡í•œ Microarchitecture êµ¬ì¡°ê°€ ì•„ë‹ˆë¼ë©´ ë³´í¸ì ìœ¼ë¡œ Jenkinsfile ì€ í”„ë¡œì íŠ¸ì˜ root ë””ë ‰í† ë¦¬ì— ìˆìŒ</li>
  <li>Github ì— ìˆëŠ” Jenkinsfile ì— ì‘ì„±ëœ declarative script ì™€ ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ì˜ ì°¨ì´ì 
    <ul>
      <li>clone ìŠ¤í…Œì´ì§€ê°€ ì—†ìŒ : Githubì˜ Jenkinsfileì„ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì€ ì´ë¯¸ Jenkins ì—ê²Œ SCM ì—ì„œ ì†ŒìŠ¤ì½”ë“œë¥¼ ê°€ì ¸ì˜¤ë¼ê³  ì§€ì‹œí•œ ê²ƒì„</li>
      <li>setup ìŠ¤í…Œì´ì§€ê°€ ì—†ìŒ : í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ëŠ” ì´ë¯¸ í†µí•©ë˜ì–´ ìˆìŒ (Jenkinsê°€ í•¸ë“¤ë§)</li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ
    <ul>
      <li>ìƒˆ íŒŒì´í”„ë¼ì¸ì„ ë§Œë“¤ê³ , íŒŒì´í”„ë¼ì¸ì˜ ì •ì˜ë¥¼ Pipeline script from SCM ìœ¼ë¡œ ì„¤ì •
        <ul>
          <li>SCM ì¢…ë¥˜ Gitìœ¼ë¡œ ì„¤ì •</li>
          <li>Repository URL ì„¤ì •</li>
          <li>ë¸Œëœì¹˜ ì„¤ì •</li>
        </ul>
      </li>
      <li>Build Now
        <ul>
          <li>Declarative: Checkout SCM ìŠ¤í…Œì´ì§€ê°€ ìë™ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
:ET